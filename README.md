# Проектная работа "Веб-ларек"
Интернет-магазин с товарами для веб-разработчиков — "Web-ларёк".

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс состояния приложения
```
export interface IAppStatus {
    catalog: ICard[];                   // Список товаров
    basket: ICard[];                    // Корзина
    preview: string | null;             // Товар в режиме предпросмотра
    delivery: IOrdersDelivery | null;   // Данные доставки
    contact: IOrdersContacts | null;    // Контактные данные
    order: IOrder | null;               // Текущий заказ
}
```

Интерфейс для отображения страницы
```
export interface IPage {
    counter: number;            // Счетчик товаров в корзине
    catalog: HTMLElement[];     // Список элементов каталога
    locked: boolean;            // Заблокирована ли прокрутка страницы
}
```

Интерфейс для описания карточки товара
```
export interface ICard {
    id: string;                 // Уникальный идентификатор товара
    description: string;        // Описание товара
    image: string;              // Ссылка на изображение товара
    title: string;              // Название товара
    category: string;           // Категория товара
    price: number | null;       // Цена товара
    count?: string;             // Индекс или количество товара
    buttonText?: string;        // Текст кнопки (например, "Добавить в корзину")
}
```

Интерфейс для данных доставки
```
export interface IOrdersDelivery {
    payment: string;    // Способ оплаты
    address: string;    // Адрес доставки
}
```

Интерфейс для контактных данных
```
export interface IOrdersContacts {
    email: string;      // Адрес электронной почты
    phone: string;      // Номер телефона
}
```

Интерфейс для заказа, объединяющий доставку и контакты
```
export interface IOrder extends IOrdersDelivery, IOrdersContacts {
    total: number | null;       // Общая сумма заказа
    items: string[];            // Список ID товаров в заказе
}
```

// Интерфейс для успешного оформления заказа
```
export interface IOrderSuccess {
    id: string;                 // Уникальный идентификатор заказа
    total: number | null;       // Итоговая сумма
}
```

Интерфейс для отображения успешного оформления заказа
```
export interface ISuccess {
    image: string;              // Изображение успеха
    title: string;              // Заголовок сообщения
    description: string;        // Описание или текст сообщения
    total: number | null;       // Общая сумма
}
```

Интерфейс для корзины
```
export interface IBasket {
    items: HTMLElement[];       // Список элементов корзины
    total: number;              // Общая стоимость товаров в корзине
}
```

Тип ошибок для форм
```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения (MVP)

Model:
- Управляют данными и предоставляют их презентеру.

View:
- View отображает интерфейс (например, каталог товаров и корзину). 
- Реагирует на действия пользователя, такие как нажатие кнопки.

Presenter:
- Обрабатывает события от View (например, добавление товара в корзину).
- Передаёт данные из Model в View для отображения.

## Базовый код

### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleRespons` — для обработки ответа сервера, его парсинга и обработки ошибок.

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  

Методы:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 
- `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков.

### Класс Component
Базовый класс, от которого наследуются все классы, отвечающие за рендеринг интерфейса на экране. Предоставляет дочерним классам методы для работы с разметкой.

Методы:
- `toggleClass` — переключает класс определенного DOM-элемента,
- `setText` — устанавливает текст в свойство textContent определенного DOM-элемента,
- `setDisabled` — отключает переданный DOM-элемент,
- `setHidden` — скрывает определенный DOM-элемент,
- `setVisible` — отображает определенный DOM-элемент,
- `setImage` — устанавливает изображение (src) и альтернативный текст (alt) для определенного DOM-элемента,
- `render` — возвращает контейнер, из которого элементы разметки создаются с помощью метода replaceChildren.

### Класс Model
Базовый класс, предназначенный для создания данных модели, которые используются для управления данными приложения. Напрямую взаимодействует с EventEmitter, принимая данные модели и аргумент events в конструкторе.

Метод:
- `emitChanges` — уведомляет всех подписчиков о том, что модель была изменена.

## Слой данных

### Класс AppStatus
Класс для хранения текущего состояния приложения: данных о товаре, корзине, предпросмотре, заказе и ошибках. Наследуется от Model (Model<IAppStatus>).

Методы:
- `clearBasket` — для очистки данных корзины,
- `addItemToBasket` — для добавления конкретного товара в корзину,
- `deleteItemFromBasket` — для удаления конкретного товара из корзины,
- `setCards` — для отображения каталога товаров,
- `setPreview` — для открытия предпросмотра товара,
- `setOrderDelivery` — для установки данных доставки заказа,
- `setOrdersContacts` — для установки контактных данных,
- `checkOrdersValidation` — для валидации формы заказа.

## Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

### Класс Basket
Класс `Basket` отвечает за управление функционалом корзины в приложении. Он включает отображение списка товаров, подсчет общей стоимости корзины и обработку событий, связанных с корзиной.  
Класс наследуется от базового класса `Component<IBasket>`.

**Конструктор класса**

`constructor(container: HTMLElement, events: EventEmitter)` 
Создает экземпляр класса и инициализирует основные элементы корзины.

- `container: HTMLElement` — контейнер, содержащий разметку корзины.
- `events: EventEmitter` — объект для обработки событий приложения.

**Поля класса**
- `_list: HTMLElement` 
  Хранит элемент списка товаров в корзине (`.basket__list`).
- `_total: HTMLElement` 
  Хранит элемент, отображающий общую стоимость корзины (`.basket__price`).
- `_button: HTMLButtonElement`
  Хранит кнопку оформления заказа (`.basket__button`).

**Методы**
- `set items(items: HTMLElement[])` - Устанавливает новый список товаров в корзине
- `set total(total: number)` - Устанавливает и форматирует текст общей стоимости корзины в элементе

---

### Класс Card
Класс `Card` отвечает за управление отображением карточек товаров в приложении, включая отображение информации о товаре (название, категория, цена, изображение) и взаимодействие с карточкой (например, добавление в корзину).  
Класс наследуется от базового класса `Component<ICard>`.

**Конструктор класса**

`constructor(container: HTMLElement, actions?: ICardActions)`  
Создает экземпляр класса и инициализирует основные элементы карточки товара.

- `container: HTMLElement` — контейнер, содержащий разметку карточки товара.
- `actions?: ICardActions` — объект с обработчиком события клика (опционально).  

**Поля класса**
- `_category: HTMLElement` - Отображает категорию товара.
- `_title: HTMLElement` - Отображает название товара.
- `_image?: HTMLImageElement` - Содержит изображение товара.
- `_description?: HTMLElement`- Содержит описание товара.
- `_button?: HTMLButtonElement` - Содержит кнопку взаимодействия (например, «Добавить в корзину»).
- `_price?: HTMLElement` - Отображает цену товара.
- `_count?: HTMLElement`- Отображает индекс товара (например, номер в корзине).

**Методы**

- `set id(value: string)` - Устанавливает уникальный идентификатор товара в атрибут `data-id`.
- `get id(): string` - Возвращает уникальный идентификатор товара.
- `set title(value: string)` - Устанавливает текст названия товара.
- `get title(): string`- Возвращает название товара.
- `set image(value: string)`- Устанавливает URL изображения товара и alt-текст.
- `set description(value: string | string[])` - Устанавливает описание товара. Поддерживает как строку, так и массив строк.
- `set button(value: string)`- Устанавливает текст кнопки (например, «Добавить в корзину»).
- `set price(value: number | null)` - станавливает цену товара. Если цена отсутствует (`null`), отображает «Бесценно».
- `get price(): number` - Возвращает цену товара.
- `set index(value: string)` - Устанавливает индекс товара (например, номер в списке корзины).
- `get index(): string`- Возвращает индекс товара.
- `set category(value: string)` - Устанавливает категорию товара и добавляет соответствующий класс для оформления.
- `get category(): string`- Возвращает категорию товара.
- `set buttonText(value: string)`- Устанавливает текст кнопки.
- `setDisabled()` - Отключает кнопку (делает ее неактивной).

---

### Класс OrdersDelivery
Класс `OrdersDelivery` отвечает за отображение и управление формой ввода данных для доставки. Поддерживает выбор способа оплаты и обработку событий формы.  
Класс наследуется от базового класса `Form<IOrdersDelivery>`.

**Конструктор класса**

`constructor(container: HTMLFormElement, events: IEvents, actions: IActions)`  
Создает экземпляр класса и инициализирует основные элементы формы доставки.

- `container: HTMLFormElement` — контейнер, содержащий разметку формы.
- `events: IEvents` — объект для обработки событий приложения.
- `actions: IActions` — объект с обработчиком события клика по кнопкам выбора способа оплаты.

**Поля класса**
- `_card: HTMLButtonElement` - Кнопка выбора оплаты картой (`[name="card"]`).
- `_cash: HTMLButtonElement` - Кнопка выбора оплаты наличными (`[name="cash"]`).

**Методы**
- `set address(value: string)`-  Устанавливает значение адреса в поле ввода формы.
- `changeButtonsClasses()`  -  Переключает активное состояние кнопок выбора способа оплаты, добавляя или удаляя класс `button_alt-active`.

---

### Класс OrdersContacts
Класс `OrdersContacts` отвечает за отображение и управление формой ввода контактных данных.  
Класс наследуется от базового класса `Form<IOrdersContacts>`.

**Конструктор класса**
`constructor(container: HTMLFormElement, events: IEvents)`  
Создает экземпляр класса и инициализирует основные элементы формы.
- `container: HTMLFormElement` — контейнер, содержащий разметку формы.
- `events: IEvents` — объект для обработки событий приложения.

**Поля класса**
- Поле ввода номера телефона (`phone`).
- Поле ввода электронной почты (`email`).

**Методы**

- `set phone(value: string)`  - Устанавливает значение номера телефона в соответствующее поле ввода формы.
- `set email(value: string)`  - Устанавливает значение электронной почты в соответствующее поле ввода формы.
---

### Класс Modal
Класс `Modal` отвечает за управление модальным окном в приложении, включая отображение контента, обработку событий открытия и закрытия окна.  
Класс наследуется от базового класса `Component<IModalData>`.

**Конструктор класса**

`constructor(container: HTMLElement, events: IEvents)`  
Создает экземпляр класса и инициализирует основные элементы модального окна.

- `container: HTMLElement` — контейнер, содержащий разметку модального окна.
- `events: IEvents` — объект для обработки событий приложения.

**Поля класса**
- `_closeButton: HTMLButtonElement`  - Кнопка закрытия модального окна (`.modal__close`).
- `_content: HTMLElement`  - Контейнер для отображения контента внутри модального окна (`.modal__content`).


**Методы**

- `set content(value: HTMLElement)`  - Устанавливает новый контент в модальном окне.
- `open()`  -  Открывает модальное окно.  
- `close()`  - Закрывает модальное окно.  
- `render(data: IModalData): HTMLElement`  - Рендерит модальное окно с указанным контентом.

---

### Класс Success
Класс `Success` отвечает за отображение информации об успешном выполнении заказа, включая отображение итоговой суммы и обработку события закрытия модального окна.  
Класс наследуется от базового класса `Component<ISuccess>`.

**Конструктор класса**

`constructor(container: HTMLElement, actions: ISuccessActions)`  
Создает экземпляр класса и инициализирует основные элементы модального окна с информацией об успешной покупке.

- `container: HTMLElement` — контейнер, содержащий разметку сообщения об успехе.
- `actions: ISuccessActions` — объект с обработчиком события клика на кнопку закрытия.

**Поля класса**
- `_close: HTMLElement`  - Кнопка для закрытия модального окна (`.order-success__close`).

- `_total: HTMLElement`  - Элемент для отображения итоговой суммы заказа (`.order-success__description`).


**Методы**

- `set total(value: string)`  - Устанавливает и отображает итоговую сумму заказа.

---

### Класс Page
Класс `Page` управляет основными элементами интерфейса страницы, включая список товаров, счетчик корзины и прокрутку.  
Класс наследуется от базового класса `Component<IPage>`.

**Конструктор класса**

`constructor(container: HTMLElement, events: IEvents)`  
Создает экземпляр класса и инициализирует основные элементы страницы.

- `container: HTMLElement` — контейнер, содержащий разметку страницы.
- `events: IEvents` — объект для обработки событий приложения.

**Поля класса**
- `_counter: HTMLElement`  -  Элемент, отображающий счетчик товаров в корзине.
- `_catalog: HTMLElement`  - Галерея товаров.
- `_wrapper: HTMLElement`  - Обертка страницы для управления прокруткой.
- `_basket: HTMLElement`  - Кнопка корзины, открывающая содержимое корзины товаров.

**Методы**

- `set counter(value: number)`  - Устанавливает значение счетчика товаров и обновляет текст элемента `_counter`.
- `set catalog(items: HTMLElement[])`  - Устанавливает новый список товаров в галерее.
- `set locked(value: boolean)`  - Блокирует или разблокирует прокрутку страницы.

---
### Класс Form
Класс `Form` является базовым компонентом для работы с формами. Он предоставляет общую функциональность для обработки ввода данных, управления состоянием формы и обработки событий.  
Класс наследуется от базового класса `Component<IFormState>`.

**Конструктор класса**

`constructor(container: HTMLFormElement, events: IEvents)`  
Создает экземпляр класса и инициализирует основные элементы формы.

- `container: HTMLFormElement` — контейнер, содержащий разметку формы.
- `events: IEvents` — объект для обработки событий приложения.

**Поля класса**
- `_submit: HTMLButtonElement`  - Кнопка отправки формы (`button[type=submit]`).

- `_errors: HTMLElement`  - Элемент для отображения ошибок формы (`.form__errors`).

**Методы**

- `protected onInputChange(field: keyof T, value: string)`  -Обрабатывает изменения в полях формы.
- `set valid(value: boolean)`  -  Устанавливает валидность формы, блокируя или разблокируя кнопку отправки.
- `set errors(value: string)`  - Устанавливает текст ошибок в элемент `_errors`.
- `render(state: Partial<T> & IFormState): HTMLElement`  - Рендерит состояние формы, включая валидность и ошибки.


## Слой коммуникации
#### Класс LarekApi
Класс LarekApi предназначен для взаимодействия с API приложения. Он наследуется от базового класса Api и реализует интерфейс ILarekApi.

Конструктор класса, принимает:
- `cdn` — базовый URL для CDN,
- `baseUrl` — базовый URL API,
- `options` — дополнительные параметры запросов (необязательный аргумент). Инициализирует свойства класса и вызывает конструктор родительского класса Api.

Методы:
- `getCardsList(): Promise<ICard[]>` — выполняет запрос на получение списка товаров
- `orderProducts(order: IOrder): Promise<IOrderSuccess>` — отправляет данные о заказе

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой, находится в файле index.ts, выполняющем роль презентера.

Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts.

В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Обрабатываемые события (в классе EventEmitter):
- `items:changed` 
    - запускает функцию, которая создаёт карточки товаров (Card) 
    - устанавливает обработчик события card:select для каждой карточки.
- `card:select` 
    - вызывает функцию, запускающую метод setPreview, который, в свою очередь, запускает обработчик события preview:changed.
- `preview:changed` 
    - выполняет запрос на получение данных о выбранном товаре по ID, 
    - создаёт предпросмотр товара и с помощью Modal.render() отображает всплывающее окно. 
    - К кнопке «Добавить в корзину» прикрепляется обработчик клика, запускающий событие item:check.
- `item:check` 
    - проверяет наличие товара в корзине. 
    - Если товара нет, запускается событие item:add, добавляющее товар в объект заказа; 
    - если товар уже есть, запускается событие item:delete, которое удаляет товар из корзины.
- `order:open` 
    - отображает модальное окно с формой для ввода адреса доставки и выбора способа оплаты через Modal.render() и данные из класса OrdersDelivery. 
    - К кнопкам выбора способа оплаты прикрепляется обработчик события payment:changed, который записывает выбранный способ оплаты в AppStatus.order.payment. 
    - К полю ввода прикрепляется обработчик ввода с событием ordersDelivery:changed. 
    - К кнопке закрытия (крестик) прикрепляется обработчик закрытия модального окна и очистки данных формы.
- `basket:open` 
    - запрашивает текущий статус корзины из класса AppStatus, отображает всплывающее окно с содержимым корзины через Modal.render(). 
    - К кнопке «Оформить заказ» прикрепляется обработчик клика, запускающий событие ordersDelivery:open. 
    - К кнопке закрытия модального окна (крестик) прикрепляется обработчик закрытия всплывающего окна.
- `basket:changed` 
    - запрашивает список товаров в корзине из класса AppStatus. 
    - Если товара нет в корзине, он добавляется, увеличивается количество товаров в корзине (count:changed) и пересчитывается общая стоимость (total). 
    - Для кнопки удаления каждого товара устанавливается обработчик клика, удаляющий товар из корзины и обновляющий общую стоимость.
- `ordersDelivery:changed` 
    - записывает данные в AppStatus.order.address, а также проверяет валидность полей ввода через метод checkOrdersDeliveryValidation(). 
    - К кнопке «Далее» прикрепляется обработчик отправки формы, запускающий событие order:submit при успешной проверке.
- `order:submit` 
    - отображает модальное окно с формой ввода номера телефона и электронной почты через Modal.render() и данные из класса OrdersContacts. 
    - К полям ввода прикрепляется обработчик события ввода, запускающий событие ordersContacts:changed.
    - К кнопке закрытия модального окна прикрепляется обработчик закрытия окна и очистки данных форм.
- `ordersContacts:changed` 
    - записывает введённые данные в AppStatus.order.phone и AppStatus.order.email, а также проверяет валидность полей ввода через метод checkOrdersContactsValidation(). 
    - В случае успешной проверки кнопка «Оплатить» становится активной, а к ней прикрепляется обработчик события contacts:submit.
- `contacts:submit` 
    - отправляет сформированный объект заказа на сервер. 
    - После успешного завершения очищает корзину, все формы заказа и сбрасывает состояние выбора способа оплаты, затем запускает событие success:open.
- `modal:open` 
    - блокирует контент страницы под модальным окном.
- `modal:close`
    - разблокирует контент страницы под модальным окном.
